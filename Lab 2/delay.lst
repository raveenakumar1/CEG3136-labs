C:\Users\Lenovo\Desktop\AlarmAssembler\delay.lst - generated by MGTEK Assembler ASM12 V1.26 Build 144 for WIN32 (x86) - Mon Sep 30 08:59:40 2024

    1:                                 ;------------------------------------------------------
    2:                                 ; Alarm System Simulation Assembler Program
    3:                                 ; File: delay.asm
    4:                                 ; Description: The Delay Module
    5:                                 ; Author: Gilbert Arbez
    6:                                 ; Date: Fall 2010
    7:                                 ;------------------------------------------------------
    8:                                 
    9:                                 ; Some definitions
   10:                                 
C:\Users\Lenovo\Desktop\AlarmAssembler\delay.asm(11): Error A2063: col(9) 'code_section': section not defined
   11:                                         SWITCH code_section
   12:                                 ;------------------------------------------------------
   13:                                 ; Subroutine delayms
   14:                                 ; Parameters: num - number of milliseconds, stored in D
   15:                                 ; Returns: nothing
   16:                                 ; Global Variables: none
   17:                                 ; Description: Delay for num milliseconds.
   18:                                 ;------------------------------------------------------
   19:     0000                        delayms:
   20:     0000                        delaymsloop1:
   21:     0000 17 09                     jsr delayonemilsec
   22:     0002 04 34 FB                  dbne D, delaymsloop1 ; Decrement then do BNE, D-- in this case
   23:     0005 3D                        rts
   24:                                 
   25:                                 ;------------------------------------------------------
   26:                                 ; Subroutine setDelay
   27:                                 ; Parameters: cnt - accumulator D
   28:                                 ; Returns: nothing
   29:                                 ; Global Variables: delayCount
   30:                                 ; Description: Intialises the delayCount 
   31:                                 ;              variable.
   32:                                 ;------------------------------------------------------
   33:     0006                        setDelay: 
   34:                                 
   35:     0006 5C 28                     std delayCount; Complete this subroutine
   36:                                 
   37:     0008 3D                        rts
   38:                                 
   39:                                 ;------------------------------------------------------
   40:                                 ; Subroutine delayonemilsec
   41:                                 ; Parameters: none
   42:                                 ; Returns: nothing
   43:                                 ; Global Variables:
   44:                                 ; Description: Delay for one millisecond.
   45:                                 ;------------------------------------------------------
   46:     0009                        delayonemilsec:
   47:     0009 CE 0BB8                   ldx #3000 ; 3000 cycles
   48:     000C                        loop0:
   49:     000C A7                        nop
   50:     000D A7                        nop
   51:     000E A7                        nop
   52:     000F A7                        nop
   53:     0010 09                        dex ; decrement x
   54:     0011 26 F9                     bne loop0 ; loop if x not equals to 0
   55:     0013 3D                        rts
   56:                                 
   57:                                     
   58:                                 ;------------------------------------------------------
   59:                                 ; Subroutine: polldelay
   60:                                 ; Parameters:  none
   61:                                 ; Returns: TRUE when delay counter reaches 0 - in accumulator A
   62:                                 ; Local Variables
   63:                                 ;   retval - acc A cntr - X register
   64:                                 ; Global Variables:
   65:                                 ;      delayCount
   66:                                 ; Description: The subroutine delays for 1 ms, decrements delayCount.
   67:                                 ;              If delayCount is zero, return TRUE; FALSE otherwise.
   68:                                 ;   Core Clock is set to 24 MHz, so 1 cycle is 41 2/3 ns
   69:                                 ;   NOP takes up 1 cycle, thus 41 2/3 ns
   70:                                 ;   Need 24 cyles to create 1 microsecond delay
   71:                                 ;   8 cycles creates a 333 1/3 nano delay
   72:                                 ;       DEX - 1 cycle
   73:                                 ;       BNE - 3 cyles - when branch is taken
   74:                                 ;       Need 4 NOP
   75:                                 ;   Run Loop 3000 times to create a 1 ms delay   
   76:                                 ;------------------------------------------------------
   77:                                 ; Stack Usage:
   78:                                         OFFSET 0  ; to setup offset into stack
   79:     0000                        PDLY_VARSIZE:
   80:     0000 +0002                  PDLY_PR_Y   DS.W 1 ; preserve Y
   81:     0002 +0002                  PDLY_PR_X   DS.W 1 ; preserve X
   82:     0004 +0001                  PDLY_PR_B   DS.B 1 ; preserve B
   83:     0005 +0002                  PDLY_RA     DS.W 1 ; return address
   84:                                 
   85:     0014 37                     polldelay: pshb
   86:     0015 34                        pshx
   87:     0016 35                        pshy
   88:     0017 DD 28                     ldy delayCount ; load delayCount
   89:     0019 86 00                     ldaa #0 ; store 0
   90:     001B 17 09                     jsr delayonemilsec ; call delayonemilsec subroutine
   91:     001D 03                        dey ; decrement y
   92:     001E 5D 28                     sty delayCount ; store y to delayCount
   93:     0020 26 02                     bne endofcode ; branch to end of code if not equal to 0
   94:     0022 86 01                     ldaa #1
   95:                                         ; Complete this routine
   96:                                 
   97:                                 
   98:                                 
   99:                                    ; restore registers and stack
  100:     0024                        endofcode:
  101:     0024 31                        puly
  102:     0025 30                        pulx
  103:     0026 33                        pulb
  104:     0027 3D                        rts
  105:                                 
  106:                                 
  107:                                 
  108:                                 ;------------------------------------------------------
  109:                                 ; Global variables
  110:                                 ;------------------------------------------------------
C:\Users\Lenovo\Desktop\AlarmAssembler\delay.asm(111): Error A2063: col(11) 'globalvar': section not defined
  111:                                    switch globalVar
  112:     0028 +0002                  delayCount ds.w 1   ; 2 byte delay counter

Symbols:
delaycount                      *00000028
delaymsloop1                    *00000000
delayonemilsec                  *00000009
endofcode                       *00000024
loop0                           *0000000c

